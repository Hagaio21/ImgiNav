experiment:
  name: controlnet_unet48_d4_new_layouts
  phase: controlnet_new_layouts
  save_path: /work3/s233249/ImgiNav/experiments/controlnet/new_layouts/controlnet_unet48_d4_new_layouts

# Diffusion checkpoint (pretrained UNet will be frozen)
diffusion:
  checkpoint: /work3/s233249/ImgiNav/experiments/diffusion/new_layouts/new_layouts_diffusion_64x64_bottleneck_attn_unet48_256_unconditional/checkpoints/new_layouts_diffusion_64x64_bottleneck_attn_unet48_256_unconditional_checkpoint_best.pt

autoencoder:
  checkpoint: /work3/s233249/ImgiNav/experiments/new_layouts/new_layouts_VAE_64x64_structural_256/new_layouts_VAE_64x64_structural_256_checkpoint_best.pt
  frozen: true

latent_clamp_min: -6.0
latent_clamp_max: 6.0

dataset:
  # Input manifest (will be replaced with embedded manifest by pipeline)
  manifest: /work3/s233249/ImgiNav/datasets/controlnet/manifest_tex.csv
  # Outputs will be updated by pipeline to use:
  #   latent: latent_path
  #   text_emb: graph_embedding_path
  #   pov_emb: pov_embedding_path
  outputs:
    latent: latent_path
    text_emb: graph_embedding_path
    pov_emb: pov_embedding_path
  filters:
    is_empty: [false]
  return_path: false
  # Taxonomy path for graph text conversion (if needed)
  taxonomy: /work3/s233249/ImgiNav/ImgiNav/config/taxonomy.json

controlnet:
  adapter:
    type: SimpleAdapter
    text_dim: 384  # Graph embedding dimension (all-MiniLM-L6-v2 outputs 384)
    pov_dim: 512   # POV embedding dimension (ResNet18 outputs 512)
    base_channels: 48  # Matches UNet base_channels
    depth: 4            # Matches UNet depth
    pov_is_spatial: false
  fusion:
    type: scaled_add
    init_scale: 0.5  # Initialize scale to 0.5 instead of 1.0 to give control features more initial influence

debug_control_features: true  # Enable debug logging for control feature magnitudes during training

training:
  seed: 42
  train_split: 0.8
  split_seed: 42
  batch_size: 32
  num_workers: 4
  shuffle: true
  epochs: 100
  learning_rate: 0.0001
  optimizer: AdamW
  weight_decay: 0.01
  save_interval: 10
  eval_interval: 5
  sample_interval: 10
  use_amp: true
  max_grad_norm: 1.0
  loss:
    type: MSELoss
    key: pred_noise
    target: noise
    weight: 1.0

